<p>
    <a href="<%= pageUrl %>../">返回上一级</a>
    &nbsp;
    <a href="<%= pageUrl %>../upload">上传文件</a><br><br>
    您现在在「文件管理 > 文件对象管理」，以下是系统所有文件对象信息
</p>
<script>
    list({
        tableElementId: "book-table"
    });

    function list({ tableElementId }) {
        getRequest("/file/object/list", { token: localStorageUtils.getToken() })
            .then(function (responseData) {
                var axiosData = responseData.data;
                var status = axiosData.status;
                var data = axiosData.data;
                if (status === "success") {
                    // console.log(data);

                    // 数据进行转换
                    var renderData = [];
                    data.forEach(element => {
                        console.log(element);
                        renderData.push({
                            编号: `${element.id}`,
                            关联文件: `<span class="overflow-omit" style="margin: 0 auto;">
                                        ID: ${element.fileId}
                                        <a href="<%= pageUrl %>../detail?id=${element.bookId}">查看</a>
                                    </span>`,
                            文件路径: `${element.filePath}`,
                            文件密码: `${element.filePwd}`,
                            提取码: `${element.fileShareCode}`,
                            存储介质: `${element.storageMediumType}`,
                            // 时间: `<span class="overflow-omit" style="font-size: 12px; line-height: 1.2em; display: block;"><nobr>
                            //             创建: ${new Date(element.fileCreateAt).toLocaleString()}<br>
                            //             修改: ${new Date(element.fileModifiedAt).toLocaleString()}
                            //         </nobr></span>`,
                            管理: `<span class="overflow-omit" style="margin: 0 auto;">
                                        <a href="<%= pageUrl %>../object-detail?id=${element.id}">修改</a>
                                        <a href="javascript:deleteBook(${element.id});">删除</a>
                                    </span>`,
                        })
                    });
                    if (renderData.length == 0) {
                        function htmlEncode(str) {
                            // refer: https://stackoverflow.com/questions/4183801/escape-html-chracters
                            var div = document.createElement('div');
                            var txt = document.createTextNode(str);
                            div.appendChild(txt);
                            return div.innerHTML;
                        }
                        renderTable({ data: `暂无文件`, tableId: tableElementId, renderTableHead: true });
                    } else {
                        renderTable({ data: renderData, tableId: tableElementId, renderTableHead: true });
                    }
                } else {
                    alert(`出错啦！${data.errMsg} (错误码: ${data.errCode}) `);
                }
            }).catch(function (error) {
                console.log(error);
                alert("无法连接到服务器，请检查网络连接！");
            });
    }
</script>