<p>
    <a href="<%= pageUrl %>upload">上传文件</a>
</p>
<script>
    list({
        tableElementId: "book-table"
    });

    function list({ tableElementId }) {
        getRequest("/file/list", {})
            .then(function (responseData) {
                var axiosData = responseData.data;
                var status = axiosData.status;
                var data = axiosData.data;
                if (status === "success") {
                    // console.log(data);

                    // 数据进行转换
                    var renderData = [];
                    data.forEach(element => {
                        console.log(element);
                        renderData.push({
                            编号: `${element.id}`,
                            关联书籍Id: `<a target="_blank" href="/admin/book-manage/detail?id=${element.bookId}">${element.bookId}</a>`,
                            文件名: `${element.fileDisplayName}`,
                            格式: `${element.fileFormat}`,
                            页数: `${element.numberOfPages}`,
                            水印: `${element.watermark}`,
                            广告: `${element.advertising}`,
                            来源: `${element.bookOrigin}`,
                            大小: `${element.fileSize}`,
                            哈希: `${element.hashSha1}`,
                            缩略图: `${element.thumbnail}`,
                            创建时间: `${element.fileCreateAt}`,
                            修改时间: `${element.fileModifiedAt}`,
                            管理: `<span class="overflow-omit" style="margin: 0 auto;">
                                        <a href="<%= pageUrl %>detail?id=${element.id}">修改</a>
                                        <a href="javascript:deleteBook(${element.id});">删除</a>
                                    </span>`,
                        })
                    });
                    if (renderData.length == 0) {
                        function htmlEncode(str) {
                            // refer: https://stackoverflow.com/questions/4183801/escape-html-chracters
                            var div = document.createElement('div');
                            var txt = document.createTextNode(str);
                            div.appendChild(txt);
                            return div.innerHTML;
                        }
                        renderTable({ data: `暂无文件`, tableId: tableElementId, renderTableHead: true });
                    } else {
                        renderTable({ data: renderData, tableId: tableElementId, renderTableHead: true });
                    }
                } else {
                    alert(`出错啦！${data.errMsg} (错误码: ${data.errCode}) `);
                }
            }).catch(function (error) {
                console.log(error);
                alert("无法连接到服务器，请检查网络连接！");
            });
    }
</script>