<div align="center">
<h1>ä¹¦æ –ç½‘ ç½‘ç«™å¼€æºé¡¹ç›®</h1>
<p>ä¸€ä¸ªå®Œå…¨å…è´¹æ— é—¨æ§›çš„è®¡ç®—æœºç±»ç”µå­ä¹¦ä¸‹è½½ç½‘ç«™</p>
</div>

é¡¹ç›®å®˜ç½‘ï¼šhttps://bookshelf.plus

å¼€æºä»“åº“ï¼š<a href="https://github.com/bookshelfplus/bookshelfplus" target="_blank">GitHub</a>  <a href="https://gitee.com/bookshelfplus/bookshelfplus" target="_blank">Gitee</a>

![](docs/image/homepage.png)

## ç®€ä»‹

å‰é¡¹ç›®ä¸ºä¹¦æ –ç½‘å®˜ç½‘å¼€æºé¡¹ç›®ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªé¡¹ç›®æ­å»ºä¸€ä¸ªå±äºè‡ªå·±çš„ç”µå­ä¹¦åˆ†äº«ä¸ç®¡ç†å¹³å°ã€‚

> ç›®å‰é¡¹ç›®å·²ä¸Šçº¿ï¼Œç½‘å€ï¼šhttps://bookshelf.plus/
>
> ä¹Ÿå¯å‰å¾€Gitä»“åº“ğŸ‘‰[GitHub](https://github.com/only-4/computer-related-books)ã€[Gitee](https://gitee.com/only4/computer-related-books)

> é¡¹ç›®éƒ¨åˆ†åŠŸèƒ½ä»åœ¨å¼€å‘ä¸­ï¼Œå¦å¤–æ–‡æ¡£éƒ¨åˆ†å†…å®¹å°šæœªæ›´æ–°ï¼Œéƒ¨ç½²ä½¿ç”¨éœ€è¦æŒæ¡ä¸€å®šçš„æŠ€æœ¯ï¼Œå¦‚æœé¡¹ç›®åæœŸçœ‹å¥½çš„äººå¤šï¼Œå°†ä¼šèŠ±ç²¾åŠ›å®Œå–„æ–‡æ¡£ä»¥åŠé€‚å½“å¢æ·»æ–°åŠŸèƒ½ã€‚



## é¡¹ç›®è®¸å¯è¯

æœ¬é¡¹ç›®ä½¿ç”¨ MIT è®¸å¯è¯ï¼Œä½†**ä¸å¾—åˆ é™¤æˆ–ä¿®æ”¹é¡¹ç›®åŸä½œè€…ä¿¡æ¯ï¼Œä¸å¾—ä½¿ç”¨æœ¬é¡¹ç›®ä½œä¸ºæ¯•ä¸šè®¾è®¡é¡¹ç›®ï¼Œæˆ–è€…å°†æœ¬é¡¹ç›®ä¼ è‡³è¯¸å¦‚CSDNç­‰ä»˜è´¹ä¸‹è½½å¹³å°**ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¸åšå…¶ä»–é™åˆ¶ï¼Œç¥æ‚¨ä½¿ç”¨æ„‰å¿« :)



## å¼€å§‹ä½¿ç”¨

> æ‰€éœ€ç¯å¢ƒï¼šJava JDK 8ï¼ŒMavenï¼ŒMySQL 5.7+ï¼ŒNode.jsï¼ŒRedisç­‰ã€‚
>
> MySQLæ¨èä½¿ç”¨8.0ä»¥ä¸Šç‰ˆæœ¬ã€‚
>
> æœ¬é¡¹ç›®é…ç½®é¡¹è¾ƒå¤šï¼Œæš‚æœªæµ‹è¯•å®å¡”æœåŠ¡å™¨ç¯å¢ƒï¼Œå¦‚æœå¯èƒ½ï¼Œå»ºè®®ä½¿ç”¨é£è±¹ä»–ç¯å¢ƒã€‚

> **ä¸‹é¢çš„é…ç½®æœ‰äº›æ²¡æœ‰è¯´æ˜å‘½ä»¤çš„æ‰§è¡Œç›®å½•ï¼Œè¯·è‡ªè¡Œåˆ¤æ–­ã€‚**è¿™éƒ¨åˆ†æ–‡æ¡£åæœŸå°†ä¼šå®Œå–„ã€‚

### å®‰è£…ç¯å¢ƒ

```bash
# å®‰è£… nodejs
# å®˜æ–¹ç½‘ç«™ï¼šhttps://nodejs.org/zh-cn/
# ä¸‹è½½åœ°å€ï¼šhttps://nodejs.org/dist/v16.14.0/node-v16.14.0-x64.msi

# å®‰è£… JDK 8
# TODO

# å®‰è£… Maven
# TODO

# å®‰è£… MySQL (5.7 ä»¥ä¸Šç‰ˆæœ¬)
# TODO

# å®‰è£… Redis
# TODO

# pm2
npm i pm2 -g

# nodemon (å¯é€‰)
# å¼€å‘ä½¿ç”¨ nodemon (ä»£ç å˜åŠ¨åè‡ªåŠ¨é‡å¯)
# ä½¿ç”¨ä»¥ä¸‹ä»£ç å®‰è£… nodemon
npm i nodemon -g
```



### ç¯å¢ƒé…ç½®

#### é…ç½®å›½å†…é•œåƒæº

##### é…ç½® npm å›½å†…é•œåƒæº

```bash
# æŸ¥çœ‹å½“å‰é…ç½®çš„é•œåƒæº é»˜è®¤ä¸º: https://registry.npmjs.org/
npm config get registry

# ä¿®æ”¹ä¸ºå›½å†…é•œåƒæº è¿™é‡Œä½¿ç”¨æ·˜å®é•œåƒæº: https://registry.npm.taobao.org/
npm config set registry https://registry.npm.taobao.org/
```



##### é…ç½® Maven å›½å†…é•œåƒæº

ç¼–è¾‘ Maven å®‰è£…ç›®å½•ä¸‹ `conf/settings.xml` æ–‡ä»¶ï¼Œå¦‚ä¸‹

```xml
  <mirrors>
    <!-- mirror
     | Specifies a repository mirror site to use instead of a given repository. The repository that
     | this mirror serves has an ID that matches the mirrorOf element of this mirror. IDs are used
     | for inheritance and direct lookup purposes, and must be unique across the set of mirrors.
     |
    <mirror>
      <id>mirrorId</id>
      <mirrorOf>repositoryId</mirrorOf>
      <name>Human Readable Name for this Mirror.</name>
      <url>http://my.repository.com/repo/path</url>
    </mirror>
     -->
    <!-- ######### ä»è¿™é‡Œå¼€å§‹ ######### -->
    <mirror>
      <id>alimaven</id>
      <name>aliyun maven</name>
      <url>https://maven.aliyun.com/repository/public</url>
      <mirrorOf>central</mirrorOf>
    </mirror>
    <!-- ######### åˆ°è¿™é‡Œç»“æŸ ######### -->
  </mirrors>
```



### ä¸‹è½½é¡¹ç›®

#### æ–¹å¼1: åœ¨ Release é¡µé¢ä¸‹è½½å‹ç¼©åŒ…

è®¿é—®ä»¥ä¸‹ç½‘å€ï¼ˆå›½å†…æ¨èä½¿ç”¨Giteeï¼‰ï¼Œä¸‹è½½æœ€æ–°ç‰ˆä»£ç åŒ…å¹¶è§£å‹å³å¯
https://gitee.com/bookshelfplus/bookshelfplus/releases

https://github.com/bookshelfplus/bookshelfplus/releases



#### æ–¹å¼2: å…‹éš† Git ä»£ç ä»“åº“

```bash
# é¦–å…ˆï¼Œå…ˆåˆ‡æ¢åˆ°å¸Œæœ›å…‹éš†åˆ°çš„æœ¬åœ°è·¯å¾„ã€‚ä¹‹åå…‹éš†é¡¹ç›®ä¼šåœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª bookshelf æ–‡ä»¶å¤¹
# ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åˆ‡æ¢åˆ°ç”¨æˆ· å®¶ ç›®å½•
# cd ~/

# é€šè¿‡ ç äº‘ å…‹éš† ï¼ˆä¹Ÿå¯é€šè¿‡ GitHub å…‹éš†ï¼‰
git clone https://gitee.com/bookshelfplus/bookshelfplus
# git clone https://github.com/bookshelfplus/bookshelfplus

# è¿›å…¥å…‹éš†çš„é¡¹ç›®æ–‡ä»¶å¤¹
cd ./bookshelfplus

# åˆ‡æ¢åˆ° master åˆ†æ”¯ä¸‹
git checkout master

# è®¾ç½®æ–‡ä»¶å¤¹æƒé™ (Windows ç”¨æˆ·å¯è·³è¿‡æ­¤æ­¥ï¼ŒLinux ç”¨æˆ·éœ€è¦è®¾ç½®)
# TODO
```



### é¡¹ç›®é…ç½®

#### é…ç½® nginx.conf

å‚è€ƒé…ç½®å¦‚ä¸‹ï¼ˆæ­¤å¤„ä»…åˆ—å‡ºæ ¸å¿ƒé…ç½®ï¼Œå®Œæ•´é…ç½®æ–‡ä»¶å¯ä»¥å‚è€ƒ[è¿™é‡Œ](./server/nginx/conf/nginx.conf)ï¼‰

```

http {
    upstream frontendNodejsServer {
        server 127.0.0.1:3000;
    }
    upstream backendSpringbootServer {
        server 127.0.0.1:8090;
    }
    server {
        listen 80;
        server_name localhost;
        # server_name bookshelf.plus;

        #ç¦æ­¢è®¿é—®çš„æ–‡ä»¶æˆ–ç›®å½•
        location ~ ^/(\.user.ini|\.htaccess|\.git|LICENSE|README.md)
        {
            return 404;
        }

        location / {
            proxy_pass http://frontendNodejsServer;
            index index.html index.htm;
        }

        location /api/ {
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_pass http://backendSpringbootServer/api/;
            index index.html index.htm;
        }
    }
}
```





```bash
# é…ç½® nginx.conf
# TODO

# [å‰ç«¯]
# é…ç½®åå° Api åœ°å€
# TODO
# é…ç½®å‰ç«¯ç½‘ç«™åç§°
# TODO

# [åç«¯]
# é…ç½® MySQL æ•°æ®åº“åœ°å€
# TODO
# é…ç½® Redis åœ°å€
# TODO
# é…ç½®ç¬¬ä¸‰æ–¹ç™»å½•
# TODO thirdparty.sample.properties -> thirdparty.properties
```

é…ç½®å¥½åï¼Œéœ€è¦é‡å¯ nginx

```bash
# é‡å¯ nginx
nginx -s reload
# æˆ–è€…ä½¿ç”¨å…¶ä»–é‡å¯å‘½ä»¤
# ä¾‹å¦‚ Ubuntu ç³»ç»Ÿä¸‹ä½¿ç”¨ systemctl restart nginx
```



### å¤„ç†ä¾èµ–

```bash
# [å‰ç«¯]
npm install

# [åç«¯]
mvn clean install
```



### æ•°æ®å¯¼å…¥

```bash
# [æ•°æ®åº“]
# å¯¼å…¥æ•°æ®åº“ SQL è„šæœ¬
# TODO
```



### ç¼–è¯‘åç«¯é¡¹ç›®

```bash
mvn clean install

# å¦‚æœæç¤º: Cannot create resource output directory: xxx
# é‚£ä¹ˆè¯´æ˜æƒé™ä¸å¤Ÿï¼Œåœ¨å‰é¢åŠ ä¸Š sudo
# sudo mvn clean install
```

ç¼–è¯‘æˆåŠŸåï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼ˆå…¶ä¸­æœ‰ `BUILD SUCCESS`ï¼‰ï¼š

```bash
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  12:17 min
[INFO] Finished at: 2022-04-03T14:22:18+08:00
[INFO] ------------------------------------------------------------------------
```



### åˆ›å»ºäº‘æœåŠ¡ï¼ˆè…¾è®¯äº‘ï¼‰

#### å¯¹è±¡å­˜å‚¨ï¼ˆCOSï¼‰

> æœ¬é¡¹ç›®äº‘æœåŠ¡ä½¿ç”¨è…¾è®¯äº‘ï¼Œå…¶ä»–äº‘å‚å•†æš‚ä¸æ”¯æŒã€‚å¼€å§‹ä¹‹å‰ï¼Œä½ éœ€è¦æœ‰ä¸€ä¸ªè…¾è®¯äº‘è´¦å·ã€‚
>
> è¯·æ³¨æ„ï¼Œä½¿ç”¨äº‘æœåŠ¡å¯èƒ½ä¼šäº§ç”Ÿè´¹ç”¨ï¼Œä½¿ç”¨å‰è¯·æ‚¨è¯¦ç»†äº†è§£ç›¸å…³æœåŠ¡çš„æ”¶è´¹ç­–ç•¥ï¼Œä»¥å…äº§ç”Ÿä¸å¿…è¦çš„è´¹ç”¨ã€‚

##### åˆ›å»ºå­˜å‚¨æ¡¶

> ä»…æ”¯æŒè…¾è®¯äº‘ COS å­˜å‚¨æ¡¶ï¼Œå…¶ä»–äº‘å‚å•†çš„å¯¹è±¡å­˜å‚¨æš‚ä¸æ”¯æŒã€‚

> éœ€è¦ä¸ºæœ¬æœåŠ¡å•ç‹¬åˆ›å»ºå­˜å‚¨æ¡¶ï¼Œä¸æ”¯æŒå’Œå…¶ä»–ä¸šåŠ¡å…±ç”¨ä¸€ä¸ªå­˜å‚¨æ¡¶ã€‚

é¦–å…ˆç™»å½•è…¾è®¯äº‘æ§åˆ¶å°ï¼Œè¿›å…¥å¯¹è±¡å­˜å‚¨é¡µé¢ï¼š

https://console.cloud.tencent.com/cos/bucket

ç‚¹å‡»åˆ›å»ºå­˜å‚¨æ¡¶ã€‚

åˆ›å»ºCOSå­˜å‚¨æ¡¶çš„æ—¶å€™ä¸€å®šè¦åˆ›å»ºåœ¨CSFå¯ç”¨åŒºåŸŸã€‚ï¼ˆå»ºè®®é€‰æ‹©ä¸Šæµ·ï¼Œå› ä¸ºåé¢åˆ›å»ºäº‘å‡½æ•°éœ€è¦ä¸å¯¹è±¡å­˜å‚¨åœ¨åŒä¸€åœ°åŸŸï¼Œè€Œäº‘å‡½æ•°åªæ”¯æŒä»¥ä¸‹åœ°åŒºï¼‰

> - åå—åœ°åŒºï¼šå¹¿å·
> - åä¸œåœ°åŒºï¼šä¸Šæµ·
> - ååŒ—åœ°åŒºï¼šåŒ—äº¬
> - è¥¿å—åœ°åŒºï¼šæˆéƒ½

ã€TODOã€‘å›¾éœ€è¦æ›´æ–°

![image-20220407215810950](docs/image/image-20220407215810950.png)

é«˜çº§å¯é€‰é…ç½®å¯ä»¥æ ¹æ®è‡ªå·±å®é™…éœ€æ±‚è¿›è¡Œé…ç½®ï¼Œæ­¤å¤„ä¿æŒé»˜è®¤ä¸åšæ›´æ”¹ã€‚

![image-20220407220043606](docs/image/image-20220407220043606.png)

ç‚¹å‡»åˆ›å»ºï¼Œå®Œæˆå­˜å‚¨æ¡¶çš„åˆ›å»ºã€‚

ã€TODOã€‘å›¾éœ€è¦æ›´æ–°

![image-20220407220149829](docs/image/image-20220407220149829.png)



##### é…ç½®å­˜å‚¨æ¡¶

###### é…ç½®è·¨åŸŸè®¿é—®

ç”±äºè…¾è®¯äº‘å­˜å‚¨æ¡¶å’Œæˆ‘ä»¬çš„ä¸šåŠ¡åŸŸåä¸åœ¨åŒä¸€ä¸»åŸŸä¸‹ï¼Œæ‰€ä»¥éœ€è¦é…ç½® CORS è·¨åŸŸè®¿é—®ï¼Œå¦åˆ™æµè§ˆå™¨è¯·æ±‚çš„æ—¶å€™ä¼šå‡ºç°æŠ¥é”™ï¼Œæ— æ³•å®Œæˆè¯·æ±‚ã€‚

> å¦‚æœæ‚¨ä¸äº†è§£ CORS æ˜¯ä»€ä¹ˆçš„è¯ï¼Œå»ºè®®æ‚¨é˜…è¯»ä¸€ä¸‹è¿™ç¯‡ MDN æ–‡æ¡£ï¼š[è·¨æºèµ„æºå…±äº«CORS](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS)ï¼ˆå…¶ä¸­çš„æè¿°å¯èƒ½æœ‰äº›ä¸“ä¸šï¼Œå¤§æ¦‚çœ‹çœ‹å°±å¥½ï¼‰
>
> ä¹Ÿå¯ä»¥çœ‹ä¸€ä¸‹è…¾è®¯äº‘çš„å®˜æ–¹æ–‡æ¡£ï¼š[è®¾ç½®è·¨åŸŸè®¿é—®](https://cloud.tencent.com/document/product/436/13318)

è¿™é‡Œæ·»åŠ ä¸€æ¡**è·¨åŸŸè®¿é—®CORSè§„åˆ™**

![image-20220407220755779](docs/image/image-20220407220755779.png)

**æ¥æº Origin** å¡«å†™è‡ªå·±çš„ä¸šåŠ¡åŸŸåï¼Œæ³¨æ„åç»­å¯¹å­˜å‚¨æ¡¶çš„è¯·æ±‚éœ€è¦é€šè¿‡æ­¤åŸŸåå‘å‡ºã€‚å¦‚æœæ‚¨åªæ˜¯è‡ªå·±æœ¬åœ°æµ‹è¯•ï¼Œæ–¹ä¾¿èµ·è§å¯ä»¥ç›´æ¥å¡«å†™ `*` ï¼Œä½†æ˜¯å¦‚æœæ‚¨å¸Œæœ›å‘ä»–äººåˆ†äº«ï¼Œæ‚¨æœ€å¥½è¿˜æ˜¯è®¾ç½®ä¸€ä¸‹ï¼Œå¦åˆ™å®¹æ˜“è¢«åˆ«äººåˆ·æµé‡ã€‚

**æ“ä½œ Methods** å¯ä»¥å…¨éƒ¨å‹¾ä¸Šã€‚ç›®å‰é¡¹ç›®ä½¿ç”¨åˆ°çš„ç”± `PUT`ï¼Œ`GET` å’Œ `DELETE` ä¸‰ç§ã€‚

å…¶ä½™é…ç½®ä¿æŒé»˜è®¤å³å¯ã€‚

![image-20220407221145206](docs/image/image-20220407221145206.png)

é…ç½®å¥½åç‚¹å‡»ä¿å­˜å³å¯ã€‚



###### é…ç½®é˜²ç›—é“¾ï¼ˆå¯é€‰ï¼‰

è¿™ä¸ªé…ç½®ä¸é…ä¸ä¼šå½±å“ä¸šåŠ¡æ­£å¸¸ä½¿ç”¨ï¼Œä½†æ˜¯å¼ºçƒˆå»ºè®®æ‚¨é…ç½®ä¸€ä¸‹ã€‚å› ä¸ºä¸é…ç½®çš„è¯å…¶ä»–äººå¯ä»¥å°†æ‚¨çš„ä¸‹è½½é“¾æ¥åµŒå…¥ä»–ä»¬çš„ç½‘ç«™ï¼Œè¿™æ ·çš„è¯æ‚¨éœ€è¦ä¸ºå…¶æ”¯ä»˜è´¹ç”¨ã€‚

> referer åœ¨æµè§ˆå™¨å‘è¯·æ±‚çš„æ—¶å€™ä¼šå°†æ‰€åœ¨çš„ç½‘ç«™åŸŸåé€šè¿‡ referer è¯·æ±‚æ ‡å¤´å‘ç»™æœåŠ¡ç«¯ã€‚â‘¢ ç©º referer ä¸€èˆ¬æŒ‡çš„æ˜¯ç”¨æˆ·ç›´æ¥è®¿é—®èµ„æºé“¾æ¥ï¼Œè€Œä¸æ˜¯é€šè¿‡ç‚¹å‡»ç½‘é¡µä¸Šçš„è¶…é“¾æ¥è®¿é—®çš„æƒ…æ™¯ï¼ˆä¹Ÿå¯èƒ½æ˜¯é€šè¿‡è®¾ç½®äº†ä¸å‘é€ referer è¯·æ±‚å¤´çš„ç½‘é¡µè®¿é—®è¿‡æ¥ï¼‰ï¼Œè‡ªå·±è§†æƒ…å†µè®¾ç½®ã€‚
>
> é˜²ç›—é“¾å¯ä»¥å‚è€ƒè…¾è®¯äº‘å®˜æ–¹æ–‡æ¡£ï¼š[é˜²ç›—é“¾](https://cloud.tencent.com/document/faq/436/56651)

![image-20220407221534955](docs/image/image-20220407221534955.png)

>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œhttp å’Œ https ï¼Œwww å’Œ ä¸å¸¦www éœ€è¦éƒ½éœ€è¦é…ç½®ã€‚
>
>ä¾‹å¦‚ï¼Œè‹¥æ‚¨é…ç½®åç”¨æˆ·å¯ä»¥é€šè¿‡ http://bookshelf.plusã€http://www.bookshelf.plusã€https://bookshelf.plusã€https://www.bookshelf.plus åŸŸåè®¿é—®åˆ°ï¼Œé‚£ä¹ˆéœ€è¦é…ç½®å¦‚ä¸‹ï¼š
>
>```
>http://bookshelf.plus
>http://www.bookshelf.plus
>https://bookshelf.plus
>https://www.bookshelf.plus
>```
>
>è‹¥æ‚¨åœ¨äºŒçº§åŸŸåä¸‹éƒ¨ç½²ï¼Œä¾‹å¦‚ site.bookshelf.plus ï¼Œé‚£ä¹ˆéœ€è¦é…ç½®å¦‚ä¸‹ï¼š
>
>```
>http://site.bookshelf.plus
>https://site.bookshelf.plus
>```
>
>å¯¹äºä¸Šè¿°å‡ ç§æƒ…å†µï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼Œä»¥å…è®¸åŸŸåä¸‹æ‰€æœ‰å­åŸŸå¯¹èµ„æºçš„è®¿é—®ã€‚
>
>```
>http://*.bookshelf.plus
>https://*.bookshelf.plus
>```



###### é…ç½®è‡ªå®šä¹‰ CDN åŠ é€ŸåŸŸåï¼ˆTODOï¼‰

> å‚è€ƒè…¾è®¯äº‘å®˜æ–¹æ–‡æ¡£ï¼š[CDN åŠ é€ŸåŸŸå](https://cloud.tencent.com/document/faq/436/56558)

TODO

ä¸Šä¼ ï¼šåç«¯ç”Ÿæˆå¸¦æœ‰æ•ˆæœŸçš„é¢„æˆæƒURLï¼Œå‰ç«¯ä½¿ç”¨è¿™ä¸ª URL è¿›è¡Œä¸Šä¼ ã€‚

ä¸‹è½½ï¼šåç«¯è®¡ç®—å¥½ CDN å›æºé‰´æƒè¿”å›ç»™å‰ç«¯ï¼Œå‰ç«¯é€šè¿‡è¿™ä¸ªé‰´æƒ URL ä¸‹è½½æ–‡ä»¶ã€‚



##### é…ç½®æ—¥å¿—è®°å½•ï¼ˆå¯é€‰ï¼‰

å¦‚æœæ‚¨éœ€è¦å¼€å¯æ—¥å¿—è®°å½•ï¼Œå¯ä»¥æŒ‰ç…§ä¸‹å›¾æ­¥éª¤è¿›è¡Œé…ç½®ï¼Œå¦‚æœä¸éœ€è¦å°±ä¸é…ç½®ã€‚

![image-20220407223556238](docs/image/image-20220407223556238.png)



#### äº‘å‡½æ•°ï¼ˆServerless å‡½æ•°æœåŠ¡ï¼‰

> ä¸ºä»€ä¹ˆè¦åˆ›å»ºäº‘å‡½æ•°ï¼Ÿ
>
> äº‘å‡½æ•°å¯¹è±¡å­˜å‚¨æ–‡ä»¶ä¸Šä¼ æˆåŠŸæ—¶è§¦å‘ï¼Œåå°ä¸Šä¼ æ–‡ä»¶åé€šè¿‡è¯¥äº‘å‡½æ•°å‘ŠçŸ¥åç«¯æœåŠ¡æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œä»¥ä¾¿åç«¯æœåŠ¡åŠæ—¶æ›´æ–°æ•°æ®åº“ä¸­è®°å½•åŠè¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ã€‚
>
> ä¸åˆ›å»ºå¯ä»¥å—ï¼Ÿ
>
> å¯ä»¥ï¼Œä½†ä¸æ¨èã€‚å¦‚æœä¸åˆ›å»ºï¼Œé‚£ä¹ˆä¸Šä¼ æ–‡ä»¶åéƒ¨åˆ†å¼±ç½‘æƒ…å†µä¸‹åç«¯æ–‡ä»¶ä¸Šä¼ çŠ¶æ€ä¸ä¼šæ›´æ–°ï¼Œéœ€è¦æ‰‹åŠ¨ç‚¹å‡»åˆ·æ–°æ‰ä¼šæ›´æ–°ã€‚

##### åˆ›å»º Serverless å‡½æ•°

> è…¾è®¯äº‘å®˜æ–¹æ–‡æ¡£ï¼šCOS è§¦å‘å™¨è¯´æ˜
> https://cloud.tencent.com/document/product/583/9707

> æ³¨æ„ï¼Œä¸€ä¸ªå­˜å‚¨æ¡¶åŒä¸€ä¸ªç±»åˆ«çš„è§¦å‘äº‹ä»¶ä»…èƒ½é€‰æ‹©ä¸€ä¸ª

æ‰“å¼€è…¾è®¯äº‘æ§åˆ¶å° Serverlessåå°ï¼šhttps://console.cloud.tencent.com/scf/list

ç‚¹å‡»æ–°å»ºã€‚

![image-20220409164929861](docs/image/image-20220409164929861.png)

**åŸºç¡€é…ç½®ï¼š**ä¿®æ”¹å¦‚ä¸‹ä¿¡æ¯ã€‚

![image-20220422084554692](docs/image/image-20220422084554692.png)

**å‡½æ•°ä»£ç ï¼š**é€‰æ‹©åœ¨çº¿ç¼–è¾‘ï¼Œæ‰§è¡Œæ–¹æ³•ä¿æŒé»˜è®¤ï¼ˆ`index.main_handler`ï¼‰ã€‚

å°†é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹ [utils/QCloudSCF/index.js](utils/QCloudSCF/index.js) ä»£ç æ–‡ä»¶ä¸­å†…å®¹ç²˜è´´è‡³ä¸‹æ–¹åœ¨çº¿ç¼–è¾‘å™¨ï¼ˆåœ¨çº¿ç¼–è¾‘å™¨ä¸­çš„é»˜è®¤å†…å®¹éœ€è¦åˆ é™¤ï¼‰ã€‚

> æ³¨æ„ï¼Œå›¾ä¸­ â‘¢ å¤„è¯·ä¿®æ”¹ä¸ºæ‚¨è‡ªå·±çš„åŸŸåï¼ˆä¾‹å¦‚ç½‘ç«™éƒ¨ç½²åœ¨ `abc.example.com`ï¼Œæ­¤å¤„å°±å¡«å†™ `abc.example.com`ï¼‰ï¼Œè‹¥æ‚¨çš„ç½‘ç«™é…ç½®äº†å¤šä¸ªåŸŸåï¼Œé€‰æ‹©å…¶ä¸­ä¸€ä¸ªå¯ä»¥è®¿é—®åå°apiçš„åŸŸåå¡«å†™å³å¯ã€‚

![image-20220422085049511](docs/image/image-20220422085049511.png)

**é«˜çº§é…ç½®**ï¼šä¿æŒé»˜è®¤å³å¯ã€‚

**è§¦å‘å™¨é…ç½®ï¼š**`åˆ›å»ºè§¦å‘å™¨` å¤„é€‰æ‹© `è‡ªå®šä¹‰åˆ›å»º`ã€‚

> å‰ç¼€è¿‡æ»¤ï¼šä¸å¡«
>
> åç¼€è¿‡æ»¤ï¼šä¸å¡«

![image-20220422085806254](docs/image/image-20220422085806254.png)

ç‚¹å‡»å®Œæˆï¼Œåˆ›å»ºæˆåŠŸã€‚

![image-20220413001238233](docs/image/image-20220413001238233.png)ã€‚

ç¨ç­‰ä¸€ä¸‹ï¼Œç­‰å¾…éƒ¨ç½²å®Œæˆåï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°å‡½æ•°ç®¡ç†é¡µé¢ã€‚

åˆ›å»ºæˆåŠŸåï¼Œå»ºè®®å°† `æ‰§è¡Œè¶…æ—¶æ—¶é—´` é€‚å½“è°ƒå¤§ä¸€ç‚¹ï¼Œç‰¹åˆ«æ˜¯å½“æœåŠ¡å™¨å’Œè…¾è®¯äº‘COSèŠ‚ç‚¹è¾ƒè¿œçš„æƒ…å†µï¼Œä»¥å‡å°‘å› ç½‘ç»œé—®é¢˜å¯¼è‡´COSæ–‡ä»¶ä¸Šä¼ åç½‘ç«™åå°ä¸èƒ½åŠæ—¶æ„ŸçŸ¥ã€‚ä¸€èˆ¬å»ºè®®å¤§äº `5ç§’`ï¼Œæ­¤å¤„è°ƒä¸º `10ç§’`ã€‚

![image-20220415213234407](docs/image/image-20220415213234407.png)



#### ç”Ÿæˆ SecretIdã€SecretKey

> æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯åˆ›å»ºå­ç”¨æˆ·ï¼Œç„¶åç”Ÿæˆå­ç”¨æˆ·çš„SecrectKeyï¼Œå¦ä¸€ç§æ˜¯ç›´æ¥ç”Ÿæˆå½“å‰è´¦å·çš„SecrectKeyã€‚ä¸¤ç§æ–¹å¼å‡å¯ã€‚å¦‚æœæ‚¨å¯¹æƒé™ç®¡ç†æœ‰éœ€æ±‚ï¼Œå»ºè®®ä½¿ç”¨ç¬¬ä¸€ç§ï¼›å¦‚æœæ‚¨å¸Œæœ›å°½å¯èƒ½ç®€å•çš„é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨ç¬¬äºŒç§ã€‚å¦‚æœæ‚¨ä¸ç¡®å®šä½¿ç”¨å“ªç§ï¼Œé‚£ä¹ˆè¯·ç”¨ç¬¬ä¸€ç§ã€‚

##### ç¬¬1ç§ï¼šåˆ›å»ºå­ç”¨æˆ·

ç™»å½•è…¾è®¯äº‘åå°ï¼Œè¿›å…¥è®¿é—®ç®¡ç†ä¸‹çš„ç”¨æˆ·åˆ—è¡¨é¡µï¼šhttps://console.cloud.tencent.com/cam

ç‚¹å‡»æ–°å»ºç”¨æˆ·

![image-20220408141246583](docs/image/image-20220408141246583.png)

ç‚¹å‡»å¿«é€Ÿåˆ›å»ºã€‚

![image-20220408142012036](docs/image/image-20220408142012036.png)

æ¥ä¸‹æ¥è¿™é‡Œæœ‰å››ä¸ªåœ°æ–¹éœ€è¦é…ç½®ã€‚ä¸‹å›¾ä»…æ ‡å‡ºéœ€è¦é…ç½®çš„é¡¹ç›®ï¼Œå…·ä½“åº”è¯¥é…ç½®æˆä»€ä¹ˆè¯·ç»§ç»­å¾€ä¸‹çœ‹ã€‚

![image-20220408142047431](docs/image/image-20220408142047431.png)

> â‘  ç”¨æˆ·åï¼šè‡ªå·±éšä¾¿èµ·ä¸€ä¸ªï¼Œæ»¡è¶³è¦æ±‚å³å¯ã€‚ï¼ˆç”¨æˆ·ååˆ›å»ºåä¸å¯ä»¥ä¿®æ”¹ï¼‰
>
> â‘¡ è®¿é—®æ–¹å¼ï¼šä¿®æ”¹ä¸ºç¼–ç¨‹è®¿é—®ã€‚
>
> ![image-20220408141017781](docs/image/image-20220408141017781.png)
>
> â‘¢ ç”¨æˆ·æƒé™ï¼š
>
> <1> å–æ¶ˆ `AdministratorAccess` æƒé™ï¼›
>
> <2> æœç´¢ `QcloudCOSDataFullControl` ï¼Œå¹¶å‹¾é€‰ `QcloudCOSDataFullControl` ï¼ˆå¯¹è±¡å­˜å‚¨ï¼ˆCOSï¼‰æ•°æ®è¯»ã€å†™ã€åˆ é™¤ã€åˆ—å‡ºçš„è®¿é—®æƒé™ï¼‰
>
> ![image-20220408142738210](docs/image/image-20220408142738210.png)
>
> â‘£ æ ¹æ®è‡ªå·±çš„æƒ…å†µé€‰æ‹©å³å¯

ç‚¹å‡»åˆ›å»ºç”¨æˆ·ï¼Œç”¨æˆ·åˆ›å»ºæˆåŠŸï¼Œè·å¾—å¯†é’¥ã€‚

![image-20220408143017202](docs/image/image-20220408143017202.png)



##### ç¬¬2ç§ï¼šç›´æ¥ç”Ÿæˆ

è®¿é—®ï¼šhttps://console.cloud.tencent.com/cam/capi

ç‚¹å‡»ç»§ç»­ä½¿ç”¨ã€‚

![image-20220408141715193](docs/image/image-20220408141715193.png)

ç‚¹å‡»æ–°å»ºå¯†é’¥ã€‚

![image-20220408141742336](docs/image/image-20220408141742336.png)

å¯†é’¥åˆ›å»ºå®Œæˆã€‚

![image-20220408141827890](docs/image/image-20220408141827890.png)



### å¯åŠ¨é¡¹ç›®

```bash
# [å‰ç«¯]
# å¯åŠ¨å‰ç«¯æœåŠ¡ (é»˜è®¤ç›‘å¬ 3000 ç«¯å£)
npm run prod


# [åç«¯]
# å¯åŠ¨åç«¯æœåŠ¡ (é»˜è®¤ç›‘å¬ 8090 ç«¯å£)
# mvn install -Djar.forceCreation spring-boot:run
java -jar ./bookshelfplus/target/bookshelfplus-1.0-SNAPSHOT.jar

# åœ¨åå°æ‰§è¡Œï¼š
# java -jar ./bookshelfplus/target/bookshelfplus-1.0-SNAPSHOT.jar &

# å¦‚æœæç¤º: Cannot create resource output directory: xxx
# é‚£ä¹ˆè¯´æ˜æƒé™ä¸å¤Ÿï¼Œåœ¨å‰é¢åŠ ä¸Š sudo

# å¯åŠ¨ nginx
# TODO
```

è‹¥å¯åŠ¨æ—¶æç¤ºä»¥ä¸‹ `WARNING`ï¼Œæ˜¯å› ä¸º `JDK` ç‰ˆæœ¬è¿‡é«˜ï¼Œä¸€èˆ¬ä¸å½±å“ä½¿ç”¨ã€‚

```bash
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by com.google.inject.internal.cglib.core.$ReflectUtils$1 (file:/usr/share/maven/lib/guice.jar) to method java.lang.ClassLoader.defineClass(java.lang.String,byte[],int,int,java.security.ProtectionDomain)
WARNING: Please consider reporting this to the maintainers of com.google.inject.internal.cglib.core.$ReflectUtils$1
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a future release
```



### éªŒè¯æ˜¯å¦éƒ¨ç½²æˆåŠŸ

#### æŸ¥çœ‹åç«¯è¿è¡ŒçŠ¶æ€

```bash
# æŸ¥çœ‹åç«¯è¿è¡ŒçŠ¶æ€
# ps -A | grep java
ubuntu@xxxxxx:~$ ps -A | grep java
 558861 ?        00:00:13 java
 
# ç»“æŸåœ¨åå°è¿è¡Œçš„ Java è¿›ç¨‹
# sudo kill -9 [ç«¯å£å·]
ubuntu@xxxxxx:~$ sudo kill -9 558861
```



#### éªŒè¯äº‘å‡½æ•°æ˜¯å¦é…ç½®æˆåŠŸ

æ£€æŸ¥äº‘å‡½æ•°æ˜¯å¦èƒ½ä¸åç«¯æœåŠ¡è¿›è¡Œäº¤äº’

ç‚¹å‡»äº‘å‡½æ•°åç§°ï¼Œè¿›å…¥äº‘å‡½æ•°è¯¦æƒ…é¡µé¢ã€‚

![image-20220422154421209](docs/image/image-20220422154421209.png)

åˆ‡æ¢åˆ°â€œå‡½æ•°ä»£ç â€æ ‡ç­¾é¡µï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚

![image-20220422154522965](docs/image/image-20220422154522965.png)

å°†æµ‹è¯•æ¨¡æ¿åˆ‡æ¢ä¸º `COS å¯¹è±¡å­˜å‚¨çš„ PUT äº‹ä»¶æ¨¡æ¿`ã€‚

![image-20220422164628657](docs/image/image-20220422164628657.png)

å¾€ä¸‹æ»‘åŠ¨ï¼Œç¼–è¾‘å™¨ä¸‹æ–¹æœ‰ä¸¤ä¸ªæŒ‰é’®ï¼Œåˆ†åˆ«æ˜¯**éƒ¨ç½²**å’Œ**æµ‹è¯•**ã€‚

![image-20220422154936825](docs/image/image-20220422154936825.png)

> æ³¨æ„ï¼Œæ¯æ¬¡åœ¨ä¿®æ”¹äº‘å‡½æ•°çš„ä»£ç åéƒ½éœ€è¦ç‚¹å‡»**éƒ¨ç½²**æŒ‰é’®ï¼Œæ‰€åšçš„ä¿®æ”¹æ‰ä¼šè¢«æ›´æ–°ã€‚

æˆ‘ä»¬ç‚¹å‡»**æµ‹è¯•**ï¼Œå¦‚æœæ‚¨çœ‹åˆ°å¦‚ä¸‹è¿”å›ä¿¡æ¯ï¼Œè¯´æ˜æ‚¨çš„åç«¯æœåŠ¡å’Œäº‘å‡½æ•°å·²ç»éƒ¨ç½²æˆåŠŸã€‚

![image-20220422164836541](docs/image/image-20220422164836541.png)

è¿”å›ç»“æœç±»ä¼¼äºï¼š

```json
{"status":"success","data":{"data":"æ‚¨çš„äº‘å‡½æ•°é…ç½®æˆåŠŸã€‚","status":"success"},"tryTime":1}
```

> æ‚¨è¿˜å¯èƒ½è§åˆ°å¦‚ä¸‹é”™è¯¯ï¼š
>
> **è¯·æ±‚è¶…æ—¶**ï¼š `Invoking task timed out after 3 seconds`
>
> ![image-20220422155631095](docs/image/image-20220422155631095.png)
>
> è¿”å›ç»“æœç±»ä¼¼äºï¼š
>
> ```json
> {"errorCode":-1,"errorMessage":"Invoking task timed out after 3 seconds","requestId":"3fed8ed2-da82-41a5-beda-eaab1e12a019","statusCode":433}
> ```
>
> è§£å†³æ–¹æ³•ï¼šå¯ä»¥å°è¯•è°ƒå¤§äº‘å‡½æ•°çš„è¶…æ—¶æ—¶é—´ï¼ˆå‡½æ•°ç®¡ç†â†’å‡½æ•°é…ç½®â†’å³ä¸Šè§’**ç¼–è¾‘**â†’ç¯å¢ƒé…ç½®åˆ†ç±»ä¸‹é¢æ‰§è¡Œè¶…æ—¶æ—¶é—´é€‚å½“è°ƒå¤§ä¸€ç‚¹ï¼‰ã€‚å¦‚æœè°ƒå¤§è¶…æ—¶æ—¶é—´åä»ç„¶ä¸è¡Œï¼Œé‚£ä¹ˆè¯´æ˜äº‘å‡½æ•°æ— æ³•è®¿é—®åˆ°åç«¯æœåŠ¡ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å·²ç»éƒ¨ç½²å¹¶å¯åŠ¨ï¼Œäº‘å‡½æ•°ä¸­çš„åŸŸåæ˜¯å¦é…ç½®æ­£ç¡®ã€‚
>
> 
>
> **æœªåˆ›å»º COS è§¦å‘å™¨**ï¼š`JSONè§£æå‡ºé”™ï¼`
>
> ![image-20220422161228789](docs/image/image-20220422161228789.png)
>
> è¿”å›ç»“æœç±»ä¼¼äºï¼š
>
> ```json
> {"status":"success","data":{"data":{"errCode":10001,"errMsg":"JSONè§£æå‡ºé”™ï¼"},"status":"failed"},"tryTime":1}
> ```
>
> è§£å†³æ–¹æ³•ï¼šæ£€æŸ¥æ‚¨çš„äº‘å‡½æ•°â€œè§¦å‘ç®¡ç†â€é¡µé¢æ˜¯å¦å·²åˆ›å»ºå¦‚ä¸‹è§¦å‘å™¨ã€‚å¦‚æœæ²¡æœ‰æˆ–ä¸æ­£ç¡®ï¼Œè¯·åˆ›å»ºæˆ–ä¿®æ”¹ä¸ºæ­£ç¡®é…ç½®ã€‚
>
> ![image-20220422161504404](docs/image/image-20220422161504404.png)
>
> 
>
> å¦‚æœæ‚¨è¿˜é‡åˆ°äº†å…¶ä»–è¿”å›ç»“æœï¼Œè¯·å‚è€ƒé”™è¯¯æç¤ºè¿›è¡Œå¤„ç†ã€‚



## åœæ­¢é¡¹ç›®

```bash
# åœæ­¢ nginx
# æœ‰å¦‚ä¸‹å‡ ç§åœæ­¢æ–¹å¼
nginx -s quit # ä»å®¹åœæ­¢
nginx -s stop # ç«‹å³åœæ­¢
systemctl stop nginx # ä½¿ç”¨ systemctl åœæ­¢
# ä¹Ÿå¯ç›´æ¥æ€æ‰ nginx è¿›ç¨‹

# åœæ­¢å‰ç«¯æœåŠ¡
npm run prod-stop

# åœæ­¢åç«¯æœåŠ¡
# TODO
```



## å…¶ä»–å‘½ä»¤

```bash
# æ¸…é™¤å‰ç«¯å­—ä½“ç¼“å­˜
node ./bookshelfplus-frontend/cleanup.js
```



## åŠŸèƒ½å±•ç¤º

### åŠŸèƒ½åˆ—è¡¨ï¼ˆTODOï¼‰

- [x] é¦–é¡µã€‚ç®€çº¦ï¼Œä¸€ä¸ªæœç´¢æ¡†å°±å¤Ÿäº†ã€‚åæœŸè€ƒè™‘æ·»åŠ çƒ­é—¨æœç´¢åŠŸèƒ½ã€‚
- [x] ä¹¦ç±åˆ—è¡¨é¡µï¼Œä¹Ÿæ˜¯æœç´¢ç»“æœé¡µã€‚å°±æ˜¯ä¸€ä¸ªä¹¦å•åˆ—è¡¨ï¼Œå¸¦åˆ†é¡µåŠŸèƒ½ã€‚
- [x] ä¹¦ç±è¯¦æƒ…é¡µã€‚ä¸»è¦æ˜¯æ˜¾ç¤ºä¹¦ç±çš„å„ç§è¯¦ç»†ä¿¡æ¯ï¼ˆä¹¦åï¼Œç®€ä»‹ï¼Œç¼©ç•¥å›¾ç­‰ï¼‰ï¼Œè¿˜æœ‰ä¸‹è½½æ–¹å¼ï¼ŒåŒæ—¶è¿˜æœ‰åé¦ˆåŠŸèƒ½ï¼ˆè¿æ¥å¤±æ•ˆåé¦ˆï¼Œç‰ˆæƒé—®é¢˜ç”³è¯‰ä¸‹æ¶ç­‰ï¼‰
- [x] åˆ†ç±»åˆ—è¡¨é¡µ
- [x] åˆ†ç±»è¯¦æƒ…é¡µ
- [x] ç®¡ç†å‘˜åå°ã€‚
- [x] ç”¨æˆ·ç™»å½•åå°ã€‚

### åŠŸèƒ½æˆªå›¾

ã€TODOã€‘æˆªå›¾å¾…è¡¥å……...



## é¡¹ç›®æ¶æ„

> é¡¹ç›®å‰åç«¯åˆ†ç¦»å¼€å‘ï¼Œä½¿ç”¨äº†ä¸åŒçš„æŠ€æœ¯ï¼Œé€šè¿‡nginxè¿›è¡Œåå‘ä»£ç†

**å‰ç«¯**é‡‡ç”¨`nodejs`å¼€å‘ï¼Œä½¿ç”¨`axios`ã€`jQuery`ç­‰ç»„ä»¶ã€‚

**åç«¯**é‡‡ç”¨`SpringBoot`å¼€å‘ï¼Œæ•°æ®åº“è¿æ¥ä½¿ç”¨`mybatis`ã€`alibaba druid`ï¼Œæ¥å£æ–‡æ¡£ç”Ÿæˆä½¿ç”¨`swagger2`ï¼Œå‚æ•°éªŒè¯é‡‡ç”¨`hibernate`ï¼Œæ—¥æœŸæ—¶é—´å¤„ç†ä½¿ç”¨`joda-time`å·¥å…·ç±»ï¼ŒåŒæ—¶è¿˜ä½¿ç”¨äº†`lombok`ç®€åŒ–ä»£ç ã€‚

**æ•°æ®åº“**é‡‡ç”¨`MySQL`ï¼Œä¼šè¯ç¼“å­˜é‡‡ç”¨`redis`ã€‚

**åå‘ä»£ç†**ä½¿ç”¨`nginx`ã€‚

**å¯¹è±¡å­˜å‚¨**å¯¹æ¥è…¾è®¯äº‘COSå­˜å‚¨ï¼ˆ`cos_api`ï¼‰ã€‚

**ç¬¬ä¸‰æ–¹ç™»å½•**ä½¿ç”¨ `JustAuth` å¼€æºé¡¹ç›®ï¼ˆé…åˆ `okhttp3`ï¼‰



## å¼€å‘å·¥å…·

å‰ç«¯ï¼šVS Codeï¼Œåç«¯ï¼šideaï¼Œæ•°æ®åº“ï¼šNavicat

> ä»¥ä¸Šä¸ºé¡¹ç›®å¼€å‘æ—¶æ‰€ä½¿ç”¨çš„å¼€å‘å·¥å…·ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çš„å¼€å‘å·¥å…·æ‰“å¼€ï¼Œä½†å»ºè®®ä½¿ç”¨ä»¥ä¸Šå·¥å…·æ‰“å¼€æœ¬é¡¹ç›®ï¼Œé¿å…äº§ç”Ÿä¸€äº›è«åé”™è¯¯ã€‚



## ç–‘éš¾è§£ç­”

### åŠ¨æ€å‹ç¼©å­—ä½“æŠ€æœ¯

é¡¹ç›®ä½¿ç”¨äº†åŠ¨æ€å‹ç¼©å­—ä½“æŠ€æœ¯ï¼Œå› ä¸ºä¸­æ–‡å­—ä½“åŒ…è¿‡å¤§ï¼Œæ— æ³•å¿«é€ŸåŠ è½½ï¼Œæ‰€ä»¥åœ¨ç”¨æˆ·è®¿é—®ç½‘é¡µåŠ è½½å®Œæˆåï¼Œä½¿ç”¨jså–å¾—é¡µé¢ä¸Šæ˜¾ç¤ºçš„æ‰€æœ‰æ–‡å­—ï¼Œç„¶åå‘å›ç»™åç«¯ï¼Œåç«¯è¿”å›ä¸€ä¸ªå‹ç¼©åçš„å­—ä½“åŒ…ã€‚

ç”±äºé¡µé¢ä¸Šæ˜¾ç¤ºçš„æ–‡å­—ç›¸å¯¹å­—ä½“åŒ…è€Œè¨€å¾ˆå°‘ï¼Œæ‰€ä»¥å‹ç¼©åçš„å­—ä½“åŸºæœ¬ä¸Šåªæœ‰å‡ åKåˆ°å‡ ç™¾Kï¼Œè¿™æ ·ä¾¿äºç½‘ç»œä¼ è¾“ã€‚



## å¸¸è§é—®é¢˜ FAQ

### Nginx æ— æ³•å¯åŠ¨

ã€é—®é¢˜ç‰¹å¾ã€‘å¯åŠ¨æ—¶ï¼ŒæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š

```bash
nginx: [emerg] CreateFile() "xxxxxxx/nginx.conf" failed (1113: No mapping for the Unicode character exists in the target multi-byte code page)
```

ã€é—®é¢˜åŸå› ã€‘

nginxå¯åŠ¨ç›®å½•ä¸èƒ½åŒ…å«ä¸­æ–‡ï¼Œå¦åˆ™æ— æ³•å¯åŠ¨

ã€è§£å†³æ–¹æ³•ã€‘

å°† nginx å®‰è£…åˆ°ä¸åŒ…å«ä¸­æ–‡å’Œç‰¹æ®Šå­—ç¬¦çš„ç›®å½•ä¸­



### é¡¹ç›®å¯åŠ¨åï¼Œè‡ªå®šä¹‰å­—ä½“åŠ è½½å¤±è´¥

ã€é—®é¢˜åŸå› ã€‘

å› ä¸ºé¡¹ç›®æ–‡ä»¶å¤¹çš„æƒé™ä¸å¤Ÿï¼Œå¯¼è‡´æ— æ³•ç”Ÿæˆå­—ä½“æ–‡ä»¶ï¼Œè¿›è€Œå¯¼è‡´å‰ç«¯è®¿é—®ä¸åˆ°å­—ä½“æ–‡ä»¶ã€‚

ã€è§£å†³æ–¹æ³•ã€‘

ä¿®æ”¹é¡¹ç›®æ–‡ä»¶å¤¹çš„æƒé™å’Œç”¨æˆ·ç»„ï¼Œå‚è€ƒå‘½ä»¤å¦‚ä¸‹ï¼ˆä¿®æ”¹æˆä½ è‡ªå·±çš„é…ç½®ï¼Œä¸è¦ç›´æ¥æ‰§è¡Œï¼‰

```bash
# ä¿®æ”¹ç”¨æˆ·ç»„
sudo chown -R www-data:www-data bookshelf.plus/
# www-data:www-data æ”¹æˆä½ è‡ªå·±çš„ç”¨æˆ·ç»„ï¼›bookshelf.plus/æ”¹æˆä½ æœ¬é¡¹ç›®çš„æ–‡ä»¶å¤¹

# ä¿®æ”¹æƒé™
chmod -R 755 bookshelf.plus/
```



### é¡¹ç›®å¯åŠ¨åï¼Œå¯ä»¥çœ‹åˆ°é¡¹ç›®ç•Œé¢ï¼Œä½†æ˜¯æ— æ³•æŸ¥è¯¢ã€ç™»å½•ç­‰

ã€é—®é¢˜åŸå› ã€‘

å¯èƒ½æ˜¯åç«¯æœåŠ¡æ²¡æœ‰æˆåŠŸå¯åŠ¨

ã€è§£å†³æ–¹æ³•ã€‘

é¦–å…ˆç‚¹å‡»é¡µè„šçš„â€œç½‘ç«™çŠ¶æ€æ£€æµ‹â€ï¼Œçœ‹çœ‹åå°æœåŠ¡å™¨èƒ½å¦æ­£å¸¸è¿æ¥ã€‚

å¦‚æœèƒ½å¤Ÿè¿æ¥ï¼Œé‚£ä¹ˆå°±æ˜¯åç«¯ä¸æ•°æ®åº“ä¹‹é—´çš„è¿æ¥å‡ºç°äº†é—®é¢˜ã€‚

> ä¾‹å¦‚æ•°æ®åº“æ²¡å¼€ï¼Œæ•°æ®åº“æ²¡æœ‰å¯¼å…¥SQLæ–‡ä»¶ï¼Œåç«¯çš„æ•°æ®åº“è¿æ¥ä¿¡æ¯é…ç½®é”™è¯¯ç­‰ç­‰

å¦‚æœä¸èƒ½è¿æ¥ï¼Œé‚£ä¹ˆå°±æ˜¯åç«¯æœåŠ¡çš„é—®é¢˜ï¼Œæ£€æŸ¥ä¸€ä¸‹åç«¯æœåŠ¡æ˜¯å¦å·²ç»æ‰“å¼€äº†ã€‚



### äº‘æœåŠ¡å™¨ä¸Šï¼Œé¡¹ç›®å¯åŠ¨æˆåŠŸï¼Œä½†æ˜¯æ— æ³•è®¿é—®ç½‘é¡µ

ã€é—®é¢˜åŸå› ã€‘

å¯èƒ½æ˜¯ nginx æ–‡ä»¶é…ç½®é”™è¯¯ï¼Œæˆ–è€…æœåŠ¡å™¨çš„ç«¯å£æ²¡æœ‰å¯¹å¤–å¼€æ”¾

ã€è§£å†³æ–¹æ³•ã€‘

æ£€æŸ¥ä¸€ä¸‹

- äº‘æœåŠ¡å™¨çš„â€œå®‰å…¨ç»„â€ï¼ˆä¸åŒå‚å•†æœ‰ä¸åŒçš„å«æ³•ï¼‰ä¸­æ˜¯å¦å¼€æ”¾äº†80ç«¯å£
- nginx é…ç½®æ˜¯å¦æ­£ç¡®ï¼ˆä¸»è¦çœ‹ `server_name`, `listen`, `location` ç­‰é…ç½®ï¼‰



### é¡¹ç›®å¯åŠ¨åï¼ŒDruidDataSource ç–¯ç‹‚æŠ¥é”™ create connection SQLException, ...

ã€é”™è¯¯åŸå› ã€‘æ•°æ®åº“è®¿é—®ä¸äº†

ã€è§£å†³æ–¹æ³•ã€‘

æ£€æŸ¥ä¸€ä¸‹æ•°æ®åº“æ˜¯å¦å¼€å¯ï¼Œé…ç½®æ–‡ä»¶ä¸­çš„æ•°æ®åº“é…ç½®æ˜¯å¦æ­£ç¡®ï¼Œä»¥åŠé…ç½®çš„ MySQL ç”¨æˆ·æ˜¯å¦æœ‰è®¿é—®æƒé™

ã€é”™è¯¯æ—¥å¿—ã€‘

```bash
2022-04-25 00:34:32.726 ERROR 18344 --- [reate-335731589] com.alibaba.druid.pool.DruidDataSource   : create connection SQLException, url: jdbc:mysql://127.0.0.1:3306/bookshelfplus?useSSL=false&serverTimezone=Asia/Shanghai, errorCode 0, state 08S01

com.mysql.cj.jdbc.exceptions.CommunicationsException: Communications link failure

The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
	at com.mysql.cj.jdbc.exceptions.SQLError.createCommunicationsException(SQLError.java:174) ~[mysql-connector-java-8.0.28.jar:8.0.28]
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:64) ~[mysql-connector-java-8.0.28.jar:8.0.28]
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:829) ~[mysql-connector-java-8.0.28.jar:8.0.28]
	at com.mysql.cj.jdbc.ConnectionImpl.<init>(ConnectionImpl.java:449) ~[mysql-connector-java-8.0.28.jar:8.0.28]
	at com.mysql.cj.jdbc.ConnectionImpl.getInstance(ConnectionImpl.java:242) ~[mysql-connector-java-8.0.28.jar:8.0.28]
	at com.mysql.cj.jdbc.NonRegisteringDriver.connect(NonRegisteringDriver.java:198) ~[mysql-connector-java-8.0.28.jar:8.0.28]
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1657) ~[druid-1.2.8.jar:1.2.8]
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1723) ~[druid-1.2.8.jar:1.2.8]
	at com.alibaba.druid.pool.DruidDataSource$CreateConnectionThread.run(DruidDataSource.java:2838) ~[druid-1.2.8.jar:1.2.8]
Caused by: com.mysql.cj.exceptions.CJCommunicationsException: Communications link failure

The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
	at sun.reflect.GeneratedConstructorAccessor59.newInstance(Unknown Source) ~[na:na]
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45) ~[na:1.8.0_201]
	at java.lang.reflect.Constructor.newInstance(Constructor.java:423) ~[na:1.8.0_201]
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:61) ~[mysql-connector-java-8.0.28.jar:8.0.28]
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:105) ~[mysql-connector-java-8.0.28.jar:8.0.28]
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:151) ~[mysql-connector-java-8.0.28.jar:8.0.28]
	at com.mysql.cj.exceptions.ExceptionFactory.createCommunicationsException(ExceptionFactory.java:167) ~[mysql-connector-java-8.0.28.jar:8.0.28]
	at com.mysql.cj.protocol.a.NativeSocketConnection.connect(NativeSocketConnection.java:89) ~[mysql-connector-java-8.0.28.jar:8.0.28]
	at com.mysql.cj.NativeSession.connect(NativeSession.java:120) ~[mysql-connector-java-8.0.28.jar:8.0.28]
	at com.mysql.cj.jdbc.ConnectionImpl.connectOneTryOnly(ConnectionImpl.java:949) ~[mysql-connector-java-8.0.28.jar:8.0.28]
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:819) ~[mysql-connector-java-8.0.28.jar:8.0.28]
	... 6 common frames omitted
Caused by: java.net.ConnectException: Connection refused: connect
	at java.net.DualStackPlainSocketImpl.connect0(Native Method) ~[na:1.8.0_201]
	at java.net.DualStackPlainSocketImpl.socketConnect(DualStackPlainSocketImpl.java:79) ~[na:1.8.0_201]
	at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350) ~[na:1.8.0_201]
	at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206) ~[na:1.8.0_201]
	at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188) ~[na:1.8.0_201]
	at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:172) ~[na:1.8.0_201]
	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392) ~[na:1.8.0_201]
	at java.net.Socket.connect(Socket.java:589) ~[na:1.8.0_201]
	at com.mysql.cj.protocol.StandardSocketFactory.connect(StandardSocketFactory.java:156) ~[mysql-connector-java-8.0.28.jar:8.0.28]
	at com.mysql.cj.protocol.a.NativeSocketConnection.connect(NativeSocketConnection.java:63) ~[mysql-connector-java-8.0.28.jar:8.0.28]
	... 9 common frames omitted
```



### é¡¹ç›®å¯åŠ¨æŠ¥é”™ Error parsing HTTP request header

ã€é—®é¢˜åŸå› ã€‘å®¢æˆ·ç«¯æ²¡æœ‰æŒ‰ç…§è§„èŒƒå‘HTTPè¯·æ±‚

ã€è§£å†³æ–¹æ³•ã€‘ä¸å½±å“é¡¹ç›®è¿è¡Œï¼Œæ— éœ€ä¿®æ”¹ï¼Œå¯å¿½ç•¥è¯¥é”™è¯¯

ã€é”™è¯¯æ—¥å¿—ã€‘

```bash
2022-04-25 00:19:43.698  INFO 434027 --- [nio-8090-exec-1] o.apache.coyote.http11.Http11Processor   : Error parsing HTTP request header
 Note: further occurrences of HTTP request parsing errors will be logged at DEBUG level.

java.lang.IllegalArgumentException: Invalid character found in method name [0x030x000x00/*0xe00x000x000x000x000x00Cookie: ]. HTTP method names must be tokens
	at org.apache.coyote.http11.Http11InputBuffer.parseRequestLine(Http11InputBuffer.java:419) ~[tomcat-embed-core-9.0.60.jar:9.0.60]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:271) ~[tomcat-embed-core-9.0.60.jar:9.0.60]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65) ~[tomcat-embed-core-9.0.60.jar:9.0.60]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:889) ~[tomcat-embed-core-9.0.60.jar:9.0.60]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1743) ~[tomcat-embed-core-9.0.60.jar:9.0.60]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49) ~[tomcat-embed-core-9.0.60.jar:9.0.60]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191) ~[tomcat-embed-core-9.0.60.jar:9.0.60]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659) ~[tomcat-embed-core-9.0.60.jar:9.0.60]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61) ~[tomcat-embed-core-9.0.60.jar:9.0.60]
	at java.base/java.lang.Thread.run(Thread.java:829) ~[na:na]
```



### å…¶ä»–é—®é¢˜

ä»¥ä¸Šä»…åˆ—å‡ºäº†éƒ¨åˆ†å¸¸è§é—®é¢˜ï¼Œå¦‚æœæ‚¨æ²¡æœ‰æ‰¾åˆ°ç›¸å…³è§£å†³æ–¹æ³•ï¼Œå¯ä»¥åœ¨ Gitee æˆ– GitHub ä»“åº“ä¸­åˆ›å»ºä¸€ä¸ª issueã€‚æé—®æ—¶è¯·æ³¨æ„è¦å°½å¯èƒ½è¯¦ç»†åœ°æè¿°é—®é¢˜ï¼Œä»¥åŠç¤¾åŒºæé—®åŸºæœ¬ç¤¼ä»ªã€‚



## è”ç³»æˆ‘ä»¬

ç›®å‰è¯¥é¡¹ç›®ç”± ç¨‹åºå‘˜å°å¢¨ ç‹¬ç«‹å¼€å‘ï¼Œä½ å¯ä»¥åœ¨ [GitHub](https://github.com/coder-xiaomo)ã€[Gitee](https://gitee.com/coder-xiaomo)ã€[Bç«™](https://space.bilibili.com/457109942)æˆ–å¾®ä¿¡å…¬ä¼—å·ç­‰å¹³å°æ‰¾åˆ°æˆ‘ï¼ˆæ‰€æœ‰å¹³å°éƒ½æ˜¯â€œç¨‹åºå‘˜å°å¢¨â€è¿™ä¸ªåå­—ï¼‰ã€‚

å¦‚æ‚¨å¸Œæœ›åˆä½œï¼Œæˆ–è€…å…±åŒç»´æŠ¤æœ¬é¡¹ç›®ï¼Œå¯ä»¥é€šè¿‡ `admin@only4.work` ä¸æˆ‘å–å¾—è”ç³»ã€‚é‚®ä»¶ä¸»é¢˜ä¸­è¯·æ³¨æ˜ `[ä¹¦æ –ç½‘ä¸¨å¼€æºé¡¹ç›®]` æ–¹ä¾¿æˆ‘ä»¬å¿«é€Ÿäº†è§£æ‚¨çš„æ¥æ„ï¼Œè°¢è°¢ã€‚

ç²¾åŠ›æœ‰é™ï¼Œæš‚ä¸æä¾›å…è´¹å®¢æœæœåŠ¡ï¼Œå¦‚æ‚¨é‡åˆ°é—®é¢˜ï¼Œè¯·è‡ªè¡Œæœç´¢è§£å†³ã€‚è¿™ç±»ç›¸å…³é‚®ä»¶æˆ‘ä»¬å°†ä¸äºˆå›å¤ï¼Œæœ›ç†è§£ï¼
